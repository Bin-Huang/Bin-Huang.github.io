<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="theme-color" content="dark">
    <title>Sentry é«˜å¹¶å‘æ—¶ä¸ŠæŠ¥å¼‚å¸¸çš„é—®é¢˜æ’æŸ¥ | bennåšå®¢</title>

    
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'GTM-KWVCGQG', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    
    <meta property="og:site_name" content="" />
    <meta property="og:title" content="Sentry é«˜å¹¶å‘æ—¶ä¸ŠæŠ¥å¼‚å¸¸çš„é—®é¢˜æ’æŸ¥ | bennåšå®¢"/>
    <meta itemprop="name" content="Sentry é«˜å¹¶å‘æ—¶ä¸ŠæŠ¥å¼‚å¸¸çš„é—®é¢˜æ’æŸ¥ | bennåšå®¢" />
    <meta name="twitter:title" content="Sentry é«˜å¹¶å‘æ—¶ä¸ŠæŠ¥å¼‚å¸¸çš„é—®é¢˜æ’æŸ¥ | bennåšå®¢" />
    <meta name="application-name" content="Sentry é«˜å¹¶å‘æ—¶ä¸ŠæŠ¥å¼‚å¸¸çš„é—®é¢˜æ’æŸ¥ | bennåšå®¢" /><meta name="twitter:card" content="summary"/>

    <meta name="description" content="" />
    <meta name="twitter:description" content=""/>
    <meta itemprop="description" content=""/>
    <meta property="og:description" content="" />

    


    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    
    <link rel="stylesheet" href="/sass/main.min.ab99ff095f832511e24ffb2fba2b51ad473b2f7e9301d674eba2c6c3a6e8bd81.css">
    
</head>
    
    <script>
        (function() {
            const colorSchemeKey = 'ThemeColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'ThemeColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.userColorScheme = 'dark';
        } else {
            document.documentElement.dataset.userColorScheme = 'light';
        }
    })();
</script>


    <body class="dark">
        <nav class="navbar">
    <div class="container">
        <div class="flex">
            <div>
                <a class="brand" href="/">
                    
                    <span class="emoji">
                        ğŸ˜
                    </span>
                    
                    
                    bennåšå®¢
                    </a>
            </div>
            <div class="flex">
                
                <a href="/articles/">Articles</a>
                
                <a href="/index.xml">RSS</a>
                
                
                    <button id="dark-mode-button">
                    <svg class="light" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 36 36"><path fill="#FFD983" d="M30.312.776C32 19 20 32 .776 30.312c8.199 7.717 21.091 7.588 29.107-.429C37.9 21.867 38.03 8.975 30.312.776z"/><path d="M30.705 15.915a1.163 1.163 0 1 0 1.643 1.641a1.163 1.163 0 0 0-1.643-1.641zm-16.022 14.38a1.74 1.74 0 0 0 0 2.465a1.742 1.742 0 1 0 0-2.465zm13.968-2.147a2.904 2.904 0 0 1-4.108 0a2.902 2.902 0 0 1 0-4.107a2.902 2.902 0 0 1 4.108 0a2.902 2.902 0 0 1 0 4.107z" fill="#FFCC4D"/><rect x="0" y="0" width="36" height="36" fill="rgba(0, 0, 0, 0)" /></svg>
                    <svg class="dark" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 36 36"><path fill="#FFD983" d="M16 2s0-2 2-2s2 2 2 2v2s0 2-2 2s-2-2-2-2V2zm18 14s2 0 2 2s-2 2-2 2h-2s-2 0-2-2s2-2 2-2h2zM4 16s2 0 2 2s-2 2-2 2H2s-2 0-2-2s2-2 2-2h2zm5.121-8.707s1.414 1.414 0 2.828s-2.828 0-2.828 0L4.878 8.708s-1.414-1.414 0-2.829c1.415-1.414 2.829 0 2.829 0l1.414 1.414zm21 21s1.414 1.414 0 2.828s-2.828 0-2.828 0l-1.414-1.414s-1.414-1.414 0-2.828s2.828 0 2.828 0l1.414 1.414zm-.413-18.172s-1.414 1.414-2.828 0s0-2.828 0-2.828l1.414-1.414s1.414-1.414 2.828 0s0 2.828 0 2.828l-1.414 1.414zm-21 21s-1.414 1.414-2.828 0s0-2.828 0-2.828l1.414-1.414s1.414-1.414 2.828 0s0 2.828 0 2.828l-1.414 1.414zM16 32s0-2 2-2s2 2 2 2v2s0 2-2 2s-2-2-2-2v-2z"/><circle fill="#FFD983" cx="18" cy="18" r="10"/><rect x="0" y="0" width="36" height="36" fill="rgba(0, 0, 0, 0)" /></svg>
                    </button>
                
            </div>
            </div>
    </div>
</nav>

        <main>
            
<div class="container">
    <article>
        <header class="article-header">
            <div class="thumb">
                <div>
                    <h1>Sentry é«˜å¹¶å‘æ—¶ä¸ŠæŠ¥å¼‚å¸¸çš„é—®é¢˜æ’æŸ¥</h1>
                    <div class="post-meta">
                        <div>
                            
                            
                              
                            
                            By  | <time>March 21, 2022</time>
                            | 2 minutes
                        </div>
                        <div class="tags">
                            
                        </div>
                    </div>
                </div>
            </div>
        </header>
    </article>

    <div class="article-post">
    <p>æˆ‘è¿½é€ä¸€ä¸ªçº¿ä¸Šé—®é¢˜çš„å¹½çµï¼Œç›´åˆ°æ·¹æ²¡åœ¨è¿·æƒ‘çš„æ—¥å¿—æ£®æ—é‡Œã€‚æˆ‘åœ¨è„‘æµ·ä¸­è‹¦è‹¦æ€ç´¢ï¼Œèº«åä¸€å£°æƒŠå¥‡çš„é¸¦å«ï¼Œæˆ‘çŒ›ç„¶å‘ç°å½“ä½œæŒ‡å—é’ˆçš„ Sentry æŠ¥å‘Šï¼Œæ‰æ˜¯çœŸæ­£çš„è¿·æƒ‘æ¥æºâ€¦â€¦</p>
<h2 id="å‘ç°é—®é¢˜">
    <a href="#%e5%8f%91%e7%8e%b0%e9%97%ae%e9%a2%98" class="anchor">
        <svg class="icon" aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16">
            <path fill-rule="evenodd"
                d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
            </path>
        </svg>
    </a>
    å‘ç°é—®é¢˜
</h2>
<p>æˆ‘ä»¬é¡¹ç›®ä¸­ä½¿ç”¨ Sentry æ¥æ•è·é”™è¯¯ï¼Œé¡ºä¾¿ä¼šé™„å¸¦ä¸€äº›ä¸Šä¸‹æ–‡ï¼Œæ¯”å¦‚ç”¨æˆ· IDã€è¯·æ±‚é“¾è·¯ã€ç‰ˆæœ¬ç¯å¢ƒâ€¦â€¦è¿™äº›ä¸Šä¸‹æ–‡åœ¨æ’æŸ¥æ—¶éå¸¸æœ‰ç”¨ï¼Œç„¶è€Œæœ€è¿‘å´è¯¯å¯¼äº†æˆ‘ï¼Œè®©æˆ‘åœ¨é”™è¯¯çš„æ–¹å‘ä¸ŠèŠ±äº†ä¸å°‘æ—¶é—´ï¼Œå›è¿‡å¤´æ¥æ‰å‘ç°ä¸Šä¸‹æ–‡æ˜¯æœ‰è¯¯çš„ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼ŒåŸæœ¬æ˜¯ç”¨æˆ· A è§¦å‘äº†æŸä¸ªé”™è¯¯ï¼ŒSentry ä¸ŠæŠ¥é”™è¯¯çš„ä¸Šä¸‹æ–‡é‡Œå´æ˜¾ç¤ºæ˜¯ç”¨æˆ· B è§¦å‘çš„ã€‚æˆ‘è¿›ä¸€æ­¥å‘ç°ï¼Œè¿™ç§ Sentry è¯¯æŠ¥å¹¶ä¸æ˜¯ç¨³å®šå‡ºç°ï¼Œè€Œæ˜¯éšæœºå‡ºç°åœ¨é¡¹ç›®å‡ ä¹æ‰€æœ‰ç§ç±»çš„é”™è¯¯æŠ¥å‘Šé‡Œã€‚å‡ºäºç›´è§‰ï¼Œæˆ‘è®¤ä¸ºè¿™å¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªå¹¶å‘å†²çªé—®é¢˜ï¼šæ¯”å¦‚ Sentry åœ¨æŠ¥å‘Šä¸Šä¸‹æ–‡æ—¶å‡ºç°äº†å¹¶å‘å†²çªã€‚</p>
<h2 id="å®éªŒæ¨¡æ‹Ÿ">
    <a href="#%e5%ae%9e%e9%aa%8c%e6%a8%a1%e6%8b%9f" class="anchor">
        <svg class="icon" aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16">
            <path fill-rule="evenodd"
                d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
            </path>
        </svg>
    </a>
    å®éªŒæ¨¡æ‹Ÿ
</h2>
<p>ä¸‹é¢æ˜¯ä¸€æ®µæœ€ç®€å•çš„å®éªŒä»£ç ï¼šæˆ‘ä»¬å¯åŠ¨äº†ä¸¤ä¸ªå¹¶å‘çš„åç¨‹ã€åˆ†åˆ«ä¸æ–­åœ°ä¸ŠæŠ¥è‡ªå·±çš„é”™è¯¯ï¼Œç„¶åè§‚å¯Ÿä¸¤ä¸ªåç¨‹çš„é”™è¯¯ä¸Šä¸‹æ–‡ä¼šä¸ä¼šäº’ç›¸å¹²æ‰°ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// åç¨‹ä¸€ï¼šä¸æ–­ä¸ŠæŠ¥é”™è¯¯ test-sentry-1ï¼Œå¹¶é™„å¸¦ä¸Šä¸‹æ–‡ {Username: &#34;1&#34;}
</span><span class="c1"></span><span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">for</span> <span class="p">{</span>
		<span class="nx">sentry</span><span class="p">.</span><span class="nf">WithScope</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">scope</span> <span class="o">*</span><span class="nx">sentry</span><span class="p">.</span><span class="nx">Scope</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">scope</span><span class="p">.</span><span class="nf">SetUser</span><span class="p">(</span><span class="nx">sentry</span><span class="p">.</span><span class="nx">User</span><span class="p">{</span><span class="nx">Username</span><span class="p">:</span> <span class="s">&#34;1&#34;</span><span class="p">})</span>
			<span class="nx">sentry</span><span class="p">.</span><span class="nf">CaptureException</span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;test-sentry-1&#34;</span><span class="p">))</span>
		<span class="p">})</span>
	<span class="p">}</span>
<span class="p">}()</span>
<span class="c1">// åç¨‹äºŒï¼šä¸æ–­ä¸ŠæŠ¥é”™è¯¯ test-sentry-2ï¼Œå¹¶é™„å¸¦ä¸Šä¸‹æ–‡ {Username: &#34;2&#34;}
</span><span class="c1"></span><span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">for</span> <span class="p">{</span>
		<span class="nx">sentry</span><span class="p">.</span><span class="nf">WithScope</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">scope</span> <span class="o">*</span><span class="nx">sentry</span><span class="p">.</span><span class="nx">Scope</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">scope</span><span class="p">.</span><span class="nf">SetUser</span><span class="p">(</span><span class="nx">sentry</span><span class="p">.</span><span class="nx">User</span><span class="p">{</span><span class="nx">Username</span><span class="p">:</span> <span class="s">&#34;2&#34;</span><span class="p">})</span>
			<span class="nx">sentry</span><span class="p">.</span><span class="nf">CaptureException</span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;test-sentry-2&#34;</span><span class="p">))</span>
		<span class="p">})</span>
	<span class="p">}</span>
<span class="p">}()</span>
</code></pre></td></tr></table>
</div>
</div><p>å¾ˆå¿«æˆ‘ä»¬å°±ä¼šå‘ç°ï¼Œåœ¨ Sentry ä¸ŠæŠ¥çš„é”™è¯¯ä¸­ï¼Œå·²ç»éšæœºå‡ºç°äº†é”™è¯¯ä¸Šä¸‹æ–‡æ··ä¹±çš„æƒ…å†µã€‚æ¯”å¦‚åœ¨ä¸‹å›¾ï¼Œåœ¨ä»£ç ä¸­ä¸ŠæŠ¥é”™è¯¯ <code>test-sentry-2</code> é™„å¸¦äº† <code>{Username: &quot;2&quot;}</code> çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä½† Sentry å®é™…å´ä¸ŠæŠ¥äº† <code>{Username: &quot;1&quot;}</code> çš„ä¸Šä¸‹æ–‡ã€‚å¾ˆæ˜æ˜¾è¿™ä¸ªé”™è¯¯çš„ä¸Šä¸‹æ–‡è¢«å…¶ä»–å¹¶å‘åç¨‹å½±å“äº†ã€‚</p>
<p><img loading="lazy" 
    src="/pic.png" 
    alt="" 
     
    width=803 
    height="585"  /></p>
<p>æŠ“ä¸ªæ­£ç€ï¼çœ‹æ¥ Sentry æŠ¥å‘Šä¸Šä¸‹æ–‡æ—¶ç¡®å®å‡ºç°äº†å¹¶å‘å†²çªï¼ˆè‡³å°‘ç›®å‰çœ‹æ¥å¦‚æ­¤â€¦â€¦ï¼‰ã€‚</p>
<h2 id="ç†è®ºåŸå› ">
    <a href="#%e7%90%86%e8%ae%ba%e5%8e%9f%e5%9b%a0" class="anchor">
        <svg class="icon" aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16">
            <path fill-rule="evenodd"
                d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
            </path>
        </svg>
    </a>
    ç†è®ºåŸå› 
</h2>
<p>æŸ¥çœ‹ sentry-go çš„æºç ï¼Œå‘ç°å®ç°ä»£ç é‡Œå¸¸å¸¸å‡ºç°è¿™ä¸¤ä¸ªç»“æ„ä½“ <code>Scope</code> å’Œ <code>Hub</code>ã€‚</p>
<ul>
<li>Scopeï¼šå³ä¸Šä¸‹æ–‡ï¼Œå­˜æ”¾ä¸ºé”™è¯¯è¿½åŠ çš„é¢å¤–ä¿¡æ¯ï¼Œæ¯”å¦‚ç”¨æˆ· IDã€è¯·æ±‚ IDã€è¯·æ±‚è·¯å¾„ã€é™„åŠ æ ‡ç­¾â€¦â€¦</li>
<li>Hubï¼šä¹Ÿè®¸å¯ä»¥å«â€œæ•è·å™¨â€ï¼Œå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªä¸Šä¸‹æ–‡å †æ ˆã€‚
<ul>
<li>Hub.stackï¼šä¸€ä¸ªå †æ ˆï¼Œç”±å¤šå±‚ layer ç»„æˆ</li>
<li>Hub.stack[0].clientï¼šæ¯ä¸€å±‚åŒ…å«æœåŠ¡è¿æ¥å®ä¾‹</li>
<li>Hub.stack[0].scopeï¼šæ¯ä¸€å±‚ä¹Ÿå¯èƒ½åŒ…å«å½“å‰ä¸Šä¸‹æ–‡</li>
</ul>
</li>
</ul>
<p>å½“æˆ‘ä»¬ä¸ŠæŠ¥é”™è¯¯æ—¶ï¼Œæ¯æ¬¡æ‰§è¡Œ <code>sentry.CaptureException(err)</code>ï¼Œå®é™…ä¸Šæ˜¯ä»å½“å‰ hub ä¸­è·å–æœ€æ–°çš„ä¸Šä¸‹æ–‡ï¼ˆä¸€èˆ¬ä½äº stack é¡¶å±‚ï¼Œè‹¥å½“å‰å±‚æ²¡æœ‰åˆ™æŸ¥æ‰¾ä¸‹ä¸€å±‚ï¼‰ï¼Œç„¶åä¸é”™è¯¯ä¸€èµ·é€šè¿‡æœåŠ¡è¿æ¥ä¸ŠæŠ¥ã€‚</p>
<p>è€Œæ·»åŠ /åˆ é™¤ä¸Šä¸‹æ–‡æ—¶ï¼Œå¯ä»¥ç”¨ <code>hub.PushScope()</code> æˆ– <code>hub.PopScope()</code> æ–¹æ³•ï¼Œå³ä¸º hub çš„å†…éƒ¨å †æ ˆå‹å…¥ä¸€ä¸ªåŒ…å«ä¸Šä¸‹æ–‡ä¿¡æ¯çš„æ–°å †æ ˆå±‚ï¼Œæˆ–è€…å¼¹å‡ºä¸å†éœ€è¦çš„å±‚ã€‚æˆ‘ä»¬ä¸€èˆ¬ç”¨ <code>WithScope</code> æ–¹æ³•æ¥é™„åŠ ä¸€äº›ä¸´æ—¶çš„ä¸Šä¸‹æ–‡ã€‚è¿™ä¸ªæ–¹æ³•çš„åŸç†æ˜¯æ‰§è¡Œä¼ å…¥å‡½æ•°ï¼Œåœ¨ä¼ å…¥å‡½æ•°æ‰§è¡Œå‰è‡ªåŠ¨ pushï¼Œåœ¨æ‰§è¡Œåè‡ªåŠ¨ popã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// WithScope æ–¹æ³•çš„ä½¿ç”¨æ¡ˆä¾‹
</span><span class="c1"></span><span class="nx">sentry</span><span class="p">.</span><span class="nf">WithScope</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">scope</span> <span class="o">*</span><span class="nx">sentry</span><span class="p">.</span><span class="nx">Scope</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">scope</span><span class="p">.</span><span class="nf">SetUser</span><span class="p">(</span><span class="nx">sentry</span><span class="p">.</span><span class="nx">User</span><span class="p">{</span><span class="nx">Username</span><span class="p">:</span> <span class="s">&#34;1&#34;</span><span class="p">})</span>
	<span class="nx">sentry</span><span class="p">.</span><span class="nf">CaptureException</span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;test-sentry-1&#34;</span><span class="p">))</span>
<span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­ <code>WithScope</code> çš„æºç å®ç°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// Sentry çš„ WithScope æ–¹æ³•æºç 
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">hub</span> <span class="o">*</span><span class="nx">Hub</span><span class="p">)</span> <span class="nf">WithScope</span><span class="p">(</span><span class="nx">f</span> <span class="kd">func</span><span class="p">(</span><span class="nx">scope</span> <span class="o">*</span><span class="nx">Scope</span><span class="p">))</span> <span class="p">{</span>
	<span class="nx">scope</span> <span class="o">:=</span> <span class="nx">hub</span><span class="p">.</span><span class="nf">PushScope</span><span class="p">()</span>
	<span class="k">defer</span> <span class="nx">hub</span><span class="p">.</span><span class="nf">PopScope</span><span class="p">()</span>
	<span class="nf">f</span><span class="p">(</span><span class="nx">scope</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡é˜…è¯»æºç ï¼Œå¾ˆæ˜æ˜¾ <code>WithScope</code> è¿™ä¸ªæ–¹æ³•åœ¨å¹¶å‘ä¸‹ä¸å®‰å…¨ã€‚å¦‚æœä¸€ä¸ªåç¨‹ç”¨ <code>WithScope</code> åˆšåˆšå‹å…¥æ–°å±‚ã€æ­£åœ¨ç¼–è¾‘ä¸Šä¸‹æ–‡ï¼Œç„¶åå¦ä¸€ä¸ªåç¨‹ä¹Ÿå‹å…¥äº†æ–°å±‚ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°å¹¶å‘å†²çªï¼Œæ¯”å¦‚æ±¡æŸ“å…¶ä»–åç¨‹çš„ä¸Šä¸‹æ–‡ã€æˆ–è€…ç”¨å…¶ä»–åç¨‹çš„ä¸Šä¸‹æ–‡æ¥ä¸ŠæŠ¥è‡ªå·±çš„é”™è¯¯ï¼</p>
<h2 id="è®¾è®¡å¦‚æ­¤">
    <a href="#%e8%ae%be%e8%ae%a1%e5%a6%82%e6%ad%a4" class="anchor">
        <svg class="icon" aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16">
            <path fill-rule="evenodd"
                d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
            </path>
        </svg>
    </a>
    è®¾è®¡å¦‚æ­¤ï¼Ÿ
</h2>
<p>éš¾é“è¦æ€ª Sentry å®¢æˆ·ç«¯åº“å­˜åœ¨æ¼æ´ï¼Ÿä¸ï¼Œè®¾è®¡å¦‚æ­¤ï¼Œæˆ–è€…æ›´åƒæ˜¯è¿«ä¸å¾—å·²ã€‚</p>
<p>Sentry åŸºäº Scope Stack çš„è®¾è®¡å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç»§æ‰¿å’Œæ‹“å±•ä¸Šä¸‹æ–‡ï¼Œå°¤å…¶åœ¨ç¨‹åºä¸åŒå±‚çº§ä¹‹é—´å¾ˆæœ‰ç”¨ã€‚å› ä¸º Sentry ä¸æ˜¯åªé¢å‘ Golang è¿™é—¨è¯­è¨€ï¼Œè¿˜éœ€è¦æ”¯æŒ Node.jsã€Pythonã€PHPã€C#â€¦â€¦æ‰€ä»¥ Sentry å¿…é¡»è¦åœ¨æ‰€æœ‰è¯­è¨€ä¸­å°½å¯èƒ½åšåˆ°æ¥å£ç»Ÿä¸€ï¼Œåƒ <code>push</code>ã€<code>pop</code>ã€<code>withScope</code> è¿™ç±»æ“ä½œéƒ½æ˜¯ç»Ÿä¸€æä¾›çš„ã€‚ç„¶è€Œåœ¨ Golang ä¸­ï¼Œè¦è®© <code>WithScope</code> æ–¹æ³•åšåˆ°<strong>å…¨å±€</strong>å¹¶å‘å®‰å…¨å‡ ä¹ä¸å¤ªç°å®ã€‚å› ä¸ºå¦‚æœåŠ é”çš„è¯ï¼Œ<code>WithScope</code> çš„é”™è¯¯ä¸ŠæŠ¥åªèƒ½ä¸²è¡Œæ‰§è¡Œäº†ï¼Œä¸¥é‡å½±å“äº†ä¸ŠæŠ¥æ€§èƒ½ã€‚</p>
<h2 id="è§„é¿æ–¹æ³•">
    <a href="#%e8%a7%84%e9%81%bf%e6%96%b9%e6%b3%95" class="anchor">
        <svg class="icon" aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16">
            <path fill-rule="evenodd"
                d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z">
            </path>
        </svg>
    </a>
    è§„é¿æ–¹æ³•
</h2>
<p>æ—¢ç„¶å…¨å±€å¹¶å‘å®‰å…¨åšä¸åˆ°ï¼Œé‚£ä¹ˆå±€éƒ¨å¹¶å‘å®‰å…¨è¿˜æ˜¯å¯ä»¥æœ‰çš„ã€‚åªè¦æ¯ä¸ªåç¨‹éƒ½æœ‰ä¸€ä¸ªè‡ªå·±ä¸“å±çš„ä¸Šä¸‹æ–‡å †æ ˆï¼Œé‚£ä¹ˆå°±ä¸ç”¨æ‹…å¿ƒäº’ç›¸æ±¡æŸ“çš„é—®é¢˜ã€‚ä¸ºæ­¤ Sentry ä¸“é—¨æä¾›äº† <code>hub.Clone()</code> æ–¹æ³•ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="k">go</span> <span class="kd">func</span> <span class="p">()</span> <span class="p">{</span>
	<span class="nx">hub</span> <span class="o">:=</span> <span class="nx">sentry</span><span class="p">.</span><span class="nf">CurrentHub</span><span class="p">().</span><span class="nf">Clone</span><span class="p">()</span>         <span class="c1">// è·å¾—æ–° hub
</span><span class="c1"></span>	<span class="nx">hub</span><span class="p">.</span><span class="nf">WithScope</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">scope</span> <span class="o">*</span><span class="nx">sentry</span><span class="p">.</span><span class="nx">Scope</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">// ä¸ºæ–° hub æ·»åŠ ä¸Šä¸‹æ–‡
</span><span class="c1"></span>		<span class="nx">scope</span><span class="p">.</span><span class="nf">SetTag</span><span class="p">(</span><span class="s">&#34;action&#34;</span><span class="p">,</span> <span class="s">&#34;produce&#34;</span><span class="p">)</span>
		<span class="nx">hub</span><span class="p">.</span><span class="nf">CaptureException</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>              <span class="c1">// ç”¨æ–° hub ä¸ŠæŠ¥é”™è¯¯
</span><span class="c1"></span>	<span class="p">})</span>
<span class="p">}()</span>
</code></pre></td></tr></table>
</div>
</div><p><code>Clone()</code> æ–¹æ³•ä¼šå¼•ç”¨å½“å‰ hub çš„åº•å±‚æœåŠ¡è¿æ¥ï¼Œå¹¶å¤åˆ¶ä¸€ä»½å½“å‰çš„ä¸Šä¸‹æ–‡å †æ ˆçš„æ‹·è´ï¼Œç„¶åç”Ÿæˆä¸€ä¸ªæ–°çš„ hub å®ä¾‹ã€‚å› ä¸ºå¤ç”¨äº†åº•å±‚æœåŠ¡è¿æ¥ï¼Œå¾ˆæ˜æ˜¾ hub å…‹éš†çš„æˆæœ¬å¾ˆä½ï¼Œå¯ä»¥éšç”¨éšæŠ›ã€‚<strong>å› æ­¤åœ¨å®è·µä¸­ï¼Œä¸ç®¡æ˜¯å¦å­˜åœ¨å¹¶å‘ï¼Œä¸ŠæŠ¥é”™è¯¯æ—¶éƒ½æœ€å¥½å…‹éš†ä¸€ä¸‹ hub å®ä¾‹</strong>ã€‚</p>
<p>è¿™ä¸ªæ–¹æ³•å¯ä»¥å®Œç¾åœ°è§„é¿å¹¶å‘å†²çªé—®é¢˜ï¼Œnice~</p>

    </div>
</div>

<div class="container">
    
    <nav class="flex container suggested">
        
        <a rel="prev" href="/posts/es-mapping/" title="Previous post (older)">
            <span>Previous</span>
            æ·±å…¥è®¨è®ºå‡ ç§ ES Mapping ä¿®æ”¹æ–¹æ³•å’Œå±€é™
            </a>
        
        
        
    </nav>
    
</div>
 
<div class="container">
    
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "bennhuang" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (DISQUS) {
            DISQUS.reset({
                reload: true
            })
        }
    })
</script>

</div>

</main>


        </main>
        <footer class="footer flex">
    <section class="container">
        <nav class="footer-links">
            
            <a href="/articles/">Articles</a>
            
            <a href="/index.xml">RSS</a>
            
        </nav>

        
    </section>
    <script defer src="/ts/features.aeccc1b543daef772e7584f28d3bc3e21c62dfd259256c435908dbe148b24c6c.js" 
    data-enable-footnotes="true"
    ></script>
</footer>

    </body>
</html>